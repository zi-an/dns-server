<!DOCTYPE html>
<html lang="zh">
<head>
    <meta charset="UTF-8">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Netty-Dns</title>
    <link rel="icon" href="favicon.ico"/>
    <link rel="stylesheet" href="./bootstrap.min.css">
    <script src="./jquery.min.js"></script>
</head>
<style>
    button{
        height: 30px;
    }
</style>
<body style="width: 100%">
<table class="table" id="load" >
    <!--<caption>DNS查询日志</caption>-->
    <thead>
    <tr>
        <th>ID</th>
        <th>时间</th>
        <th>客户</th>
        <th>域名</th>
        <th>IP</th>
    </tr>
    </thead>
    <tbody id="tbody">
    </tbody>
</table><a href="./mem.html">
<input type="button" value="服务器内存"   class="btn btn-default "
       style="color:blue;position: fixed;bottom: 5rem;left: 1%;">
</a>

    <input type="text" class="form-control  form-control-lg" placeholder="客户ID" id="text"
           style="color:blue;position: fixed;bottom: 5rem;right: 35%;width: 30%">
 <!--
<input type="text" placeholder="服务器IP最后一位" id="text" class="form-control"
       style="color:blue;position: fixed;bottom: 5rem;left: 30rem ">
--><input type="button" value="已暂停刷新" id="autoflash" class="btn btn-default "
       style="color:blue;position: fixed;bottom: 5rem;right: 1%;">
</body>
<script type="text/javascript">
    //页面存在的最大ID
    let maxid = 0;
    //记录刷新状态
    let flash = false;
    //线程ID,与flash组合,再次点击自动刷刷新按钮杀线程
    let thread;
let ip=0;
    $(document).ready(function () {
        loadJson();
    })

    function loadJson() {
        $.getJSON("./getAll?maxid=" + maxid+"&ip="+ip, function (data) {
            let result = "";
            for (let i = 0; i < data.length; i++) {
                result += "<tr><td>" + data[i].id + "</td>";
                result += "<td>" + data[i].time.slice(11) + "</td>";
                result += "<td>" + data[i].client.slice(11) + "</td>";
                result += "<td>" + data[i].name + "</td>";
                result += "<td>" + data[i].ip + "</td></tr>";
            }
            $('#tbody').prepend(result);
            maxid = data[0].id;
        })
    }

    $(function () {
        $('#autoflash').on('click', function () {
            if (!flash) {
                flash = true;
                $('#autoflash').val("自动刷新中");
                $('#autoflash').css('color', 'red');
                thread = setInterval('loadJson()', 2000);
            } else {
                flash = false;
                clearInterval(thread);
                $('#autoflash').css('color', 'blue');
                $('#autoflash').val("已暂停刷新");
            }
        });
        $('#text').change(function () {
            $('#tbody').children().remove();
            ip= '192.168.10.'+$('#text').val();
            maxid = 0;
            loadJson();
        })
    })
</script>
</html>
<!--https://www.runoob.com/try/try.php?filename=bootstrap3-table-basic-->